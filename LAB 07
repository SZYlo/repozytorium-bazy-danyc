#____zad1____
#______A1____

SELECT c.*
FROM CLIENT c
LEFT JOIN `ORDER` o ON o.CLIENT_ID = c.CLIENT_ID
WHERE o.ORDER_ID IS NULL;

#______A2____

SELECT *
FROM CLIENT
WHERE CLIENT_ID NOT IN (
SELECT CLIENT_ID FROM `ORDER`
);

#______B_____

SELECT u.UNIT_NAME
FROM INVENTORY i
RIGHT JOIN UNIT u ON u.UNIT_ID = i.UNIT_ID
WHERE i.UNIT_ID IS NULL;

#______C_____

SELECT 
p.PRODUCT_NAME,
AVG(oi.UNIT_PRICE - p.PURCHASE_PRICE) AS AVG_MARGIN
FROM ORDER_ITEM oi
JOIN PRODUCT p ON p.PRODUCT_ID = oi.PRODUCT_ID
GROUP BY p.PRODUCT_NAME
ORDER BY AVG_MARGIN DESC;

#____zad2____
#______A_____

SELECT DISTINCT d.DEPARTMENT_NAME
FROM `ORDER` o
JOIN EMPLOYEE e ON e.EMPLOYEE_ID = o.EMPLOYEE_ID
JOIN DEPARTMENT d ON d.DEPARTMENT_ID = e.DEPARTMENT_ID;

#______B_____

SELECT 
d.DEPARTMENT_NAME,
SUM(oi.UNIT_PRICE * oi.QUANTITY) AS TOTAL_VALUE
FROM `ORDER` o
JOIN EMPLOYEE e ON e.EMPLOYEE_ID = o.EMPLOYEE_ID
JOIN DEPARTMENT d ON d.DEPARTMENT_ID = e.DEPARTMENT_ID
JOIN ORDER_ITEM oi ON oi.ORDER_ID = o.ORDER_ID
GROUP BY d.DEPARTMENT_NAME;

#______C_____

SELECT 
    d.DEPARTMENT_NAME,
    os.STATUS_NAME,
    SUM(oi.UNIT_PRICE * oi.QUANTITY) AS TOTAL_VALUE
FROM `ORDER` o
JOIN ORDER_STATUS os ON os.STATUS_ID = o.STATUS_ID
JOIN EMPLOYEE e ON e.EMPLOYEE_ID = o.EMPLOYEE_ID
JOIN DEPARTMENT d ON d.DEPARTMENT_ID = e.DEPARTMENT_ID
JOIN ORDER_ITEM oi ON oi.ORDER_ID = o.ORDER_ID
GROUP BY d.DEPARTMENT_NAME, os.STATUS_NAME;

#____zad3____
#______A_____

SELECT CONCAT(PRODUCT_NAME, ' (', DESCRIPTION, ')') AS FULL_NAME
FROM PRODUCT;

#______B_____

SELECT CONCAT_WS(', ', PRODUCT_ID, PRODUCT_NAME, DESCRIPTION, CATEGORY_ID, PURCHASE_PRICE)
FROM PRODUCT;

#______C_____

SELECT 
    d.DEPARTMENT_NAME,
    GROUP_CONCAT(CONCAT(e.FIRST_NAME, ' ', e.LAST_NAME) SEPARATOR ', ') AS EMPLOYEES
FROM EMPLOYEE e
JOIN DEPARTMENT d ON d.DEPARTMENT_ID = e.DEPARTMENT_ID
GROUP BY d.DEPARTMENT_NAME;

#______D_____

SELECT 
    c.CATEGORY_NAME,
    GROUP_CONCAT(p.PRODUCT_NAME SEPARATOR ', ') AS UNSOLD_PRODUCTS
FROM PRODUCT p
JOIN CATEGORY c ON c.CATEGORY_ID = p.CATEGORY_ID
LEFT JOIN ORDER_ITEM oi ON oi.PRODUCT_ID = p.PRODUCT_ID
WHERE oi.PRODUCT_ID IS NULL
GROUP BY c.CATEGORY_NAME;

#____zad4____
#______A_____

SELECT o.ORDER_ID,
       IF(o.STATUS_ID IN (3,4,7,10), 'Zakończone', 'Inny') AS STATUS_TEXT
FROM ORDERS o;

#______B_____

SELECT p.PRODUCT_NAME,
       CASE
            WHEN i.AMOUNT = 0 THEN 'Brak'
            WHEN i.AMOUNT < 10 THEN 'Mała ilość'
            WHEN i.AMOUNT <= 30 THEN 'Średnia ilość'
            ELSE 'Duża ilość'
       END AS DOSTEPNOSC
FROM PRODUCT p
LEFT JOIN INVENTORY i ON i.PRODUCT_ID = p.PRODUCT_ID;

#______C_____

SELECT CLIENT_NAME,
       IFNULL(TAX_IDENTIFIER, 'Klient indywidualny') AS TAX_OR_INFO
FROM CLIENT;

#____zad5____
#______A_____
SELECT CITY,
       SUBSTR(POSTAL_CODE, 1, 2) AS PREFIX
FROM CLIENT_ADDRESS;
#______B_____
SELECT CITY,
       GROUP_CONCAT(DISTINCT SUBSTR(POSTAL_CODE, 1, 2) SEPARATOR ', ') AS PREFIXES
FROM CLIENT_ADDRESS
GROUP BY CITY;
#______C_____

SELECT TRIM(
         REGEXP_REPLACE(
             REGEXP_REPLACE(STREET, '^(ul\\.|al\\.)\\s*', ''), 
             '\\s+[0-9].*$', ''
         )
       ) AS CLEAN_STREET
FROM CLIENT_ADDRESS;
