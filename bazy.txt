Zadanie 1

CREATE TABLE pracownik (
    id_pracownika INT AUTO_INCREMENT PRIMARY KEY,
    imie VARCHAR(40) NOT NULL,
    nazwisko VARCHAR(60) NOT NULL,
    data_urodzenia DATE NOT NULL
);

INSERT INTO pracownik (imie, nazwisko, data_urodzenia) VALUES
('Anna', 'Kowalska', '1990-05-15'),
('Piotr', 'Nowak', '1985-11-20'),
('Katarzyna', 'Zielińska', '1993-08-01');

UPDATE pracownik
SET data_urodzenia = '1991-06-25'
WHERE id_pracownika = 1;

Zadanie 2

CREATE TABLE zadanie (
    id_zadania INT AUTO_INCREMENT PRIMARY KEY, 
    nazwa_zadania VARCHAR(150) NOT NULL,
    priorytet ENUM('normalny', 'wysoki', 'niski'),
    opis TEXT, 
    pracownik INT,
    FOREIGN KEY (pracownik) REFERENCES pracownik(id_pracownika) ON DELETE SET NULL
);

ALTER TABLE zadanie MODIFY priorytet ENUM('normalny', 'wysoki', 'niski') DEFAULT 'normalny'; 


INSERT INTO zadanie (nazwa_zadania, pracownik, priorytet, opis) VALUES
('Przygotowanie raportu Q3', 1, 'wysoki', 'Raport wydajności za trzeci kwartał.'),
('Spotkanie z klientem X', 2, 'normalny', 'Ustalenie szczegółów nowego projektu.'),
('Szkolenie BHP', 3, 'niski', NULL);

Zadanie 3

CREATE TABLE projekt (
    id_projektu INT AUTO_INCREMENT PRIMARY KEY, 
    nazwa_projektu VARCHAR(150),
    data_rozpoczecia DATE,
    data_zakonczenia DATE NULL
);

ALTER TABLE projekt
ADD COLUMN menadzer_projektu INT,
ADD FOREIGN KEY (menadzer_projektu) REFERENCES pracownik(id_pracownika);

INSERT INTO projekt (nazwa_projektu, data_rozpoczecia, menadzer_projektu) VALUES
('Modernizacja Systemu A', '2025-01-10', 1),
('Kampania Marketingowa', '2025-02-15', 2);

ALTER TABLE zadanie
ADD COLUMN projekt INT,
ADD FOREIGN KEY (projekt) REFERENCES projekt(id_projektu) ON DELETE CASCADE;

UPDATE zadanie
SET projekt = 1
WHERE id_zadania IN (1, 3);

UPDATE zadanie
SET projekt = 2
WHERE id_zadania = 2;

Zadanie 4

CREATE TABLE sprint (
    id_sprintu INT AUTO_INCREMENT PRIMARY KEY, 
    numer_sprintu INT NOT NULL CHECK (numer_sprintu >= 0),
    data_rozpoczecia DATE NOT NULL,
    data_zakonczenia DATE NOT NULL
);

ALTER TABLE zadanie
ADD COLUMN sprint INT NULL,
ADD FOREIGN KEY (sprint) REFERENCES sprint(id_sprintu) ON DELETE SET NULL;

INSERT INTO sprint (numer_sprintu, data_rozpoczecia, data_zakonczenia) VALUES
(1, '2025-03-01', '2025-03-14');

UPDATE zadanie
SET sprint = 1
WHERE id_zadania IN (1, 2);

Zadanie 5

CREATE TABLE status (
    id_statusu INT AUTO_INCREMENT PRIMARY KEY, 
    nazwa_statusu VARCHAR(20) NOT NULL
);

INSERT INTO status (nazwa_statusu) VALUES
('Do zrobienia'),
('W toku'),
('Ukończone');

CREATE TABLE zadanie_has_status (
    id_zdarzenia INT AUTO_INCREMENT PRIMARY KEY,
    id_zadania INT NOT NULL,
    id_statusu INT NOT NULL,
    data_zdarzenia DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (id_zadania) REFERENCES zadanie(id_zadania) ON DELETE CASCADE,
    FOREIGN KEY (id_statusu) REFERENCES status(id_statusu) ON DELETE RESTRICT
);

INSERT INTO zadanie_has_status (id_zadania, id_statusu) VALUES
(1, 1),
(2, 2),
(3, 1);

DELETE FROM projekt
WHERE id_projektu = 2;

SELECT * FROM zadanie;

